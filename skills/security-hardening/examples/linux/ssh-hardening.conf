# SSH Hardening Configuration
# Place in: /etc/ssh/sshd_config.d/hardening.conf
# Test with: sshd -t
# Apply with: systemctl restart sshd

# Authentication
# ==============

# Disable root login
PermitRootLogin no

# Disable password authentication (use keys only)
PasswordAuthentication no
PermitEmptyPasswords no

# Disable challenge-response authentication
ChallengeResponseAuthentication no

# Disable Kerberos and GSSAPI
KerberosAuthentication no
GSSAPIAuthentication no

# Enable public key authentication
PubkeyAuthentication yes

# Limit authentication attempts
MaxAuthTries 3
MaxSessions 2

# Set login grace time (time to complete authentication)
LoginGraceTime 30

# Protocol and Encryption
# =======================

# Use only SSH Protocol 2
Protocol 2

# Specify strong key exchange algorithms
KexAlgorithms curve25519-sha256,curve25519-sha256@libssh.org,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512

# Specify strong ciphers
Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr

# Specify strong MACs
MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512,hmac-sha2-256

# Access Control
# ==============

# Limit users and groups (uncomment and customize)
# AllowUsers deploy admin
# AllowGroups ssh-users

# Deny specific users
# DenyUsers root guest

# Session Security
# ================

# Disable X11 forwarding
X11Forwarding no

# Disable TCP forwarding
AllowTcpForwarding no

# Disable agent forwarding
AllowAgentForwarding no

# Set idle timeout (5 minutes)
ClientAliveInterval 300
ClientAliveCountMax 2

# Limit concurrent unauthenticated connections
MaxStartups 10:30:60

# Banner and Logging
# ==================

# Display legal banner (customize path)
Banner /etc/issue.net

# Logging level
LogLevel VERBOSE

# Use privilege separation
UsePrivilegeSeparation sandbox

# Disable host-based authentication
HostbasedAuthentication no
IgnoreRhosts yes
