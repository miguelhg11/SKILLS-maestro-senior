{
  "openapi": "3.0.3",
  "info": {
    "title": "Search & Filter API",
    "description": "RESTful API specification for search and filter functionality",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "https://api.example.com/v1",
      "description": "Production server"
    },
    {
      "url": "http://localhost:8000/v1",
      "description": "Development server"
    }
  ],
  "paths": {
    "/search": {
      "get": {
        "summary": "Search with query parameters",
        "description": "Perform search using URL query parameters. Suitable for simple searches.",
        "operationId": "searchGet",
        "tags": ["Search"],
        "parameters": [
          {
            "name": "q",
            "in": "query",
            "description": "Search query text",
            "required": false,
            "schema": {
              "type": "string",
              "minLength": 1,
              "maxLength": 200
            },
            "example": "laptop"
          },
          {
            "name": "category",
            "in": "query",
            "description": "Filter by categories",
            "required": false,
            "style": "form",
            "explode": true,
            "schema": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          },
          {
            "name": "brand",
            "in": "query",
            "description": "Filter by brands",
            "required": false,
            "style": "form",
            "explode": true,
            "schema": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          },
          {
            "name": "min_price",
            "in": "query",
            "description": "Minimum price filter",
            "required": false,
            "schema": {
              "type": "number",
              "minimum": 0
            }
          },
          {
            "name": "max_price",
            "in": "query",
            "description": "Maximum price filter",
            "required": false,
            "schema": {
              "type": "number",
              "minimum": 0
            }
          },
          {
            "name": "in_stock",
            "in": "query",
            "description": "Filter for in-stock items only",
            "required": false,
            "schema": {
              "type": "boolean"
            }
          },
          {
            "name": "sort",
            "in": "query",
            "description": "Sort order",
            "required": false,
            "schema": {
              "type": "string",
              "enum": ["relevance", "price_asc", "price_desc", "newest", "rating"],
              "default": "relevance"
            }
          },
          {
            "name": "page",
            "in": "query",
            "description": "Page number",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 1
            }
          },
          {
            "name": "per_page",
            "in": "query",
            "description": "Results per page",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 20
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful search",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SearchResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid parameters",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "429": {
            "description": "Rate limit exceeded",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "post": {
        "summary": "Search with request body",
        "description": "Perform search using JSON request body. Suitable for complex searches.",
        "operationId": "searchPost",
        "tags": ["Search"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SearchRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful search",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SearchResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "429": {
            "description": "Rate limit exceeded",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/autocomplete": {
      "get": {
        "summary": "Get search suggestions",
        "description": "Returns autocomplete suggestions based on query prefix",
        "operationId": "autocomplete",
        "tags": ["Search"],
        "parameters": [
          {
            "name": "q",
            "in": "query",
            "description": "Query prefix",
            "required": true,
            "schema": {
              "type": "string",
              "minLength": 2,
              "maxLength": 50
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum suggestions",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 20,
              "default": 10
            }
          },
          {
            "name": "type",
            "in": "query",
            "description": "Suggestion type filter",
            "required": false,
            "schema": {
              "type": "string",
              "enum": ["all", "products", "categories", "brands"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Suggestions found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AutocompleteResponse"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "SearchRequest": {
        "type": "object",
        "properties": {
          "query": {
            "type": "string",
            "minLength": 1,
            "maxLength": 200,
            "description": "Search query text"
          },
          "filters": {
            "$ref": "#/components/schemas/SearchFilters"
          },
          "sort_by": {
            "type": "string",
            "enum": ["relevance", "price_asc", "price_desc", "newest", "rating"],
            "default": "relevance",
            "description": "Sort order"
          },
          "page": {
            "type": "integer",
            "minimum": 1,
            "maximum": 100,
            "default": 1,
            "description": "Page number"
          },
          "per_page": {
            "type": "integer",
            "minimum": 1,
            "maximum": 100,
            "default": 20,
            "description": "Results per page"
          },
          "include_facets": {
            "type": "boolean",
            "default": true,
            "description": "Include facet counts in response"
          }
        }
      },
      "SearchFilters": {
        "type": "object",
        "properties": {
          "categories": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "maxItems": 20,
            "description": "Category filters"
          },
          "brands": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "maxItems": 20,
            "description": "Brand filters"
          },
          "min_price": {
            "type": "number",
            "minimum": 0,
            "description": "Minimum price"
          },
          "max_price": {
            "type": "number",
            "minimum": 0,
            "description": "Maximum price"
          },
          "in_stock": {
            "type": "boolean",
            "description": "Only in-stock items"
          },
          "min_rating": {
            "type": "number",
            "minimum": 1,
            "maximum": 5,
            "description": "Minimum rating"
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Tag filters"
          }
        }
      },
      "SearchResponse": {
        "type": "object",
        "required": ["products", "total", "page", "per_page", "total_pages"],
        "properties": {
          "products": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Product"
            },
            "description": "Search results"
          },
          "total": {
            "type": "integer",
            "minimum": 0,
            "description": "Total number of results"
          },
          "page": {
            "type": "integer",
            "minimum": 1,
            "description": "Current page"
          },
          "per_page": {
            "type": "integer",
            "minimum": 1,
            "description": "Results per page"
          },
          "total_pages": {
            "type": "integer",
            "minimum": 0,
            "description": "Total number of pages"
          },
          "facets": {
            "$ref": "#/components/schemas/Facets"
          },
          "query_time_ms": {
            "type": "number",
            "description": "Query execution time in milliseconds"
          },
          "cached": {
            "type": "boolean",
            "description": "Whether result was served from cache"
          }
        }
      },
      "Product": {
        "type": "object",
        "required": ["id", "title", "price", "category", "brand"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique product identifier"
          },
          "title": {
            "type": "string",
            "description": "Product title"
          },
          "description": {
            "type": "string",
            "description": "Product description"
          },
          "price": {
            "type": "number",
            "minimum": 0,
            "description": "Product price"
          },
          "category": {
            "type": "string",
            "description": "Product category"
          },
          "brand": {
            "type": "string",
            "description": "Product brand"
          },
          "rating": {
            "type": "number",
            "minimum": 0,
            "maximum": 5,
            "description": "Average rating"
          },
          "review_count": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of reviews"
          },
          "in_stock": {
            "type": "boolean",
            "description": "Stock availability"
          },
          "image_url": {
            "type": "string",
            "format": "uri",
            "description": "Product image URL"
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Product tags"
          }
        }
      },
      "Facets": {
        "type": "object",
        "properties": {
          "categories": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Facet"
            }
          },
          "brands": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Facet"
            }
          },
          "price_ranges": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/PriceRangeFacet"
            }
          },
          "ratings": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Facet"
            }
          }
        }
      },
      "Facet": {
        "type": "object",
        "required": ["value", "count"],
        "properties": {
          "value": {
            "type": "string",
            "description": "Facet value"
          },
          "count": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of items"
          }
        }
      },
      "PriceRangeFacet": {
        "type": "object",
        "required": ["min", "max", "count", "label"],
        "properties": {
          "min": {
            "type": "number",
            "description": "Minimum price in range"
          },
          "max": {
            "type": "number",
            "description": "Maximum price in range (null for open-ended)"
          },
          "label": {
            "type": "string",
            "description": "Display label"
          },
          "count": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of items in range"
          }
        }
      },
      "AutocompleteResponse": {
        "type": "object",
        "required": ["query", "suggestions"],
        "properties": {
          "query": {
            "type": "string",
            "description": "Original query"
          },
          "suggestions": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Suggestion"
            }
          }
        }
      },
      "Suggestion": {
        "type": "object",
        "required": ["text", "type"],
        "properties": {
          "text": {
            "type": "string",
            "description": "Suggestion text"
          },
          "type": {
            "type": "string",
            "enum": ["product", "category", "brand", "query"],
            "description": "Suggestion type"
          },
          "category": {
            "type": "string",
            "description": "Associated category"
          },
          "product_id": {
            "type": "string",
            "description": "Product ID (for product suggestions)"
          },
          "count": {
            "type": "integer",
            "description": "Result count for this suggestion"
          }
        }
      },
      "ErrorResponse": {
        "type": "object",
        "required": ["error", "message", "timestamp"],
        "properties": {
          "error": {
            "type": "string",
            "description": "Error code"
          },
          "message": {
            "type": "string",
            "description": "Error message"
          },
          "details": {
            "type": "object",
            "description": "Additional error details"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "Error timestamp"
          }
        }
      }
    }
  }
}